---
- name: Disable initial gnome setup
  ansible.builtin.lineinfile:
    path: /etc/gdm3/custom.conf
    regexp: "^InitialSetupEnable"
    insertafter: '^\[daemon\]'
    line: "InitialSetupEnable=false"

- name: Disable initial gnome setup for users
  ansible.builtin.lineinfile:
    path: /etc/xdg/autostart/gnome-initial-setup-first-login.desktop
    regexp: "^X-GNOME-Autostart-enabled="
    line: "X-GNOME-Autostart-enabled=false"

- name: Ensure .config in skel directory
  ansible.builtin.file:
    path: /etc/skel/.config
    state: directory
    owner: root
    group: root
    mode: "0755"

- name: Disable initial gnome setup in skel directory
  ansible.builtin.copy:
    dest: /etc/skel/.config/gnome-initial-setup-done
    content: "yes"
    force: false
    owner: root
    group: root
    mode: "0644"

- name: Remove ubuntu-report and gnome-initial-setup package
  ansible.builtin.package:
    name:
      - ubuntu-report
      - gnome-initial-setup
    state: absent

- name: Ensure .cache/ubuntu-report in skel directory
  ansible.builtin.file:
    path: /etc/skel/.cache/ubuntu-report
    state: directory
    owner: root
    group: root
    mode: "0644"

- name: Disable gnome report in skel directory
  ansible.builtin.copy:
    dest: "/etc/skel/.cache/ubuntu-report/ubuntu.{{ ansible_distribution_version }}"
    content: '{"OptOut": true}'
    force: false
    owner: root
    group: root
    mode: "0644"
